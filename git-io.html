<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="lecode.png" type="image/x-icon" />
    <title>em...åœŸæ˜ŸğŸ˜‚~~</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            height: 100%;
            -webkit-overflow-scrolling: touch;
        }
        body {
            --SIZE: 200;
            background: no-repeat url(7.jpg);
            background-size: cover;
            width: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }
        #heart {
            position: relative;
            margin: 130px auto;
            width: calc(var(--SIZE) * 1px);
            height: calc(var(--SIZE) * 1px);
            transform: rotate(45deg);
        }
        #heart div {
            width: 100%;
            height: 100%;
            position: absolute;
            overflow: hidden;
/*             background: #000; */
        }
        #heart .rectangle {
            z-index: 3;
            border-radius: 8px;
        }
        #heart .circle-left,
        #heart .circle-top {
            z-index: 2;
            border-radius: 50%;
        }
        #heart .circle-left {
            left: -50%;
        }
        #heart .circle-top {
            top: -50%;
        }
        #heart i:nth-child(2n+1) {
            animation: blink2 3s infinite ease-in;
            -webkit-animation: blink2 3s infinite ease-in;
        }
        #heart i:nth-child(2n) {
            animation: blink 3s infinite ease-in-out;
            -webkit-animation: blink 3s infinite ease-in-out;
        }
        @keyframes blink {
            0% {
                transform: scale(.5);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0;
            }
            100% {
                transform: scale(.5);
                opacity: 1;
            }
        }
        @keyframes blink2 {
            0% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        #circle {
            position: fixed;
            width: calc(var(--SIZE) * 1px);
            height: calc(var(--SIZE) * 1px);
            border-radius: 50%;
            overflow: hidden;
        }
        #circle i {
            transition: transform 2s;
            --webkit-transition: transform 2s;
        }
        .zxx {
            width: 100%;
            height: 100%;
            float: left;
            background: rgba(0,0,0,.6)
        }
    </style>
</head>

<body>
    <div class='zxx'></div>
    <div id="heart">
        <div class="circle-left"></div>
        <div class="circle-top"></div>
        <div class="rectangle"></div>
    </div>
    <div id="circle"></div>
<!--     <audio preload autoplay loop src="Amanda McBroom - çˆ±ã¯èŠ±ã€å›ã¯ãã®ç§å­.mp3"></audio> -->
</body>

<script>
const COLORS = ['#eb125f', '#6eff8a', '#6386ff', '#f9f383', '#7CB5EC', '#2B908F', '#9966cc'];
/** æ­¤å¤„éœ€è¦æ³¨æ„ä¸‹ï¼š
 *          COLORSæ•°ç»„åé¢çš„åˆ†å·ï¼ˆ' ; 'ï¼‰ä¸èƒ½å°‘ï¼Œæ²¡æœ‰åˆ†å·ä¼šå¯¼è‡´å‰é¢çš„ä»£ç å’Œåé¢çš„ä»£ç ï¼Œè¿æ¥åˆ°ä¸€èµ·å‡ºç°éš¾ä»¥å‘ç°çš„å¼‚å¸¸
*/

(function(win, doc) {
    function RenderBall(config) {
        this.config = config
        this.getOneRandom = function(value) {
            return parseInt(Math.random() * value)
        }
    };
    let _proto = RenderBall.prototype;

    _proto.creatBall = function() {
        let config = this.config
        let ball = doc.createElement('i');

        ball.style.top = this.getOneRandom(config.height) + 'px';
        ball.style.left = this.getOneRandom(config.width) + 'px';

        ball.style.width = config.size + 'px';
        ball.style.height = config.size + 'px';
        ball.style.borderRadius = '50%';

        let len = COLORS.length;
        ball.style.backgroundColor = COLORS[this.getOneRandom(len)];

        return ball;
    };

    _proto.fillBall = function() {
        let config = this.config
        let num = config.count;

        let fragment = doc.createDocumentFragment();
        for (let index = 0; index < num; index++) {
            let ball = this.creatBall()
            ball.style.position = 'absolute';
            fragment.appendChild(ball);
        }
        return fragment
    };

    // _proto.clearBall = function(el) {
    //     let childs = el.getElementsByTagName('i')
    //     setTimeout(function() {
    //         // åˆ é™¤å­èŠ‚ç‚¹

    //         // 1. è€¿ç›´çš„æ–¹æ³•
    //         /* æ³¨ï¼šå½“åˆ é™¤ç´¢å¼•ä¸º0çš„å­èŠ‚ç‚¹åï¼ŒåŸæ¥ç´¢å¼•ä¸º1çš„èŠ‚ç‚¹æ­¤æ—¶å®ƒçš„ç´¢å¼•å˜æˆ0äº†ï¼Œè€Œå¾ªç¯å˜é‡iå·²ç»å˜æˆäº†1
    //             è§£å†³åŠæ³•ï¼šä»åå¾€å‰åˆ */ 
    //         // for(let i = childs.length - 1; i >= 0; i--){
    //         //     el.removeChild(childs[i])
    //         // }

    //         // 2. ä¾¿æ·æ–¹æ³•	
    //         while(el.firstChild) {
    //             el.removeChild(el.firstChild)
    //         }
    //     }, 1000 )
    // };

    win.RenderBall = RenderBall;
})(window, document);
</script>
<script>
drawHeart(document);

var timer = null 
timer = setInterval(_ => {
    clickBoom()
}, 2000)

// å‘å¿ƒå½¢ç›’å­é‡Œå¡«å……åœ†ç‚¹
function drawHeart(doc) {
    let heartEl = doc.getElementById('heart');
    let divArr = heartEl.children;
    for (let index = 0; index < divArr.length; index++) {
        const el = divArr[index];
        let config = {
            size: 6, 
            count: 240, 
            width: 200,
            height: 200,
        }
        if(el.className == 'circle-left') {
            config.width = config.width / 2 - 6;
            config.count = config.count / 2;
        }
        if(el.className == 'circle-top') {
            config.height = config.height / 2 - 6;
            config.count = config.count / 2;
        }
        let renderBall = new RenderBall(config);
        let fragment = renderBall.fillBall();
        el.appendChild(fragment);
    }
}

// ç‚¹å‡»åœ†ç‚¹æ‰©æ•£
function clickBoom(e) {
    let config = {
        size: 2, 
        count: 50, 
        width: 200, 
        height: 200, 
    }

    let circle = document.getElementById('circle');
    while(circle.firstChild) {
        circle.removeChild(circle.firstChild)
    }
    // å®šä½åˆ°ç‚¹å‡»ä½ç½®
    // circle.style.top = e.clientY - circle.offsetHeight / 2 + 'px';
    // circle.style.left = e.clientX - circle.offsetWidth / 2 + 'px';

    let renderBall = new RenderBall(config);
    let width = document.body.clientWidth;
    let height = document.body.clientHeight;
    let left = renderBall.getOneRandom(width);
    let top = renderBall.getOneRandom(height);
    if(top > (height - 400)) {
        top = renderBall.getOneRandom(height - 400);
    }
    if(left > (width - 300)) {
        left = renderBall.getOneRandom(width - 300);
    }
    circle.style.top = top + 'px';
    circle.style.left = left + 'px';
    
    let fragment = renderBall.fillBall();
    for (let index = 0; index < config.count; index++) {
        const ball = fragment.children[index];
        ball.style.top = '50%';
        ball.style.left = '50%';
        let xAxis = renderBall.getOneRandom(300) + 'px'
        let yAxis = renderBall.getOneRandom(300) + 'px'
        if(Math.random() < .5) {
            xAxis = -renderBall.getOneRandom(300) + 'px'
        }
        if(Math.random() < .5) {
            yAxis = -renderBall.getOneRandom(300) + 'px'
        }
        setTimeout(_ => {
            let transform = `translate3d(${xAxis}, ${yAxis}, 0px) scale(0)`;
            ball.style.transform = transform;
            ball.style.webkitTransform = transform;
        }, 10)
    }
    circle.appendChild(fragment)
}
</script>
</html>
